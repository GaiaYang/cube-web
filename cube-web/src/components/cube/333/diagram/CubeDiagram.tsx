"use client";

import React, { memo, type SVGProps } from "react";
import { deepEqual } from "fast-equals";
import { useInView } from "react-intersection-observer";

import cn from "@/utils/cn";

import type { CubeBlockPosition3D } from "@/types/cube/333";
import type { CubeFaceColor } from "@/types/cube/color";
import { getFillColor } from "@/themes/cube/colors";

export interface CubeDiagramProps extends SVGProps<SVGSVGElement> {
  size?: number;
  colorMap?: Partial<Record<CubeBlockPosition3D, CubeFaceColor>>;
}

/** 立體方塊圖 */
export default memo(function CubeDiagram({
  size,
  colorMap,
  ...props
}: CubeDiagramProps) {
  const { ref, inView } = useInView({
    triggerOnce: true,
  });

  function _renderPath(item: PathItem) {
    return (
      <path
        {...item}
        key={item.id}
        vectorEffect="non-scaling-stroke"
        className={cn(
          "stroke-1",
          "drak:stroke-slate-300 stroke-slate-400",
          getFillColor(colorMap?.[item.id]),
        )}
      />
    );
  }

  function _renderGroup(item: GroupItem) {
    return (
      <g {...item} key={item.id}>
        {item.children.map(_renderPath)}
      </g>
    );
  }

  return (
    <svg
      width={size}
      height={size}
      {...props}
      ref={ref}
      viewBox="0 0 56 56"
      className={cn({ skeleton: !inView }, props.className)}
    >
      {inView ? groups.map(_renderGroup) : null}
    </svg>
  );
}, deepEqual);

interface PathItem extends React.SVGProps<SVGPathElement> {
  id: CubeBlockPosition3D;
}

interface GroupItem extends Omit<React.SVGProps<SVGGElement>, "children"> {
  id: "up" | "front" | "side";
  children: PathItem[];
}

const groups: GroupItem[] = [
  {
    id: "front",
    transform: "matrix(3.870286,0,0,3.870286,-21.335022,-2.6308982)",
    children: [
      {
        id: "F-BR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 11.646258,11.690609 2.453369,1.039278 c 0.03206,0.01358 0.05735,0.04882 0.05666,0.07897 l -0.05267,2.309989 c -6.28e-4,0.02751 -0.02575,0.03808 -0.05631,0.02375 l -2.342847,-1.098611 c -0.02792,-0.01309 -0.05092,-0.04522 -0.05161,-0.07207 l -0.05786,-2.250671 c -7.54e-4,-0.02931 0.0221,-0.04299 0.05127,-0.03063 z",
      },
      {
        id: "F-BC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 8.9419769,10.545041 2.1961841,0.930331 c 0.02863,0.01213 0.05248,0.04541 0.05345,0.07458 l 0.07432,2.240888 c 8.87e-4,0.02675 -0.0205,0.0379 -0.04791,0.02504 L 9.1105318,12.827638 c -0.02517,-0.0118 -0.046983,-0.0423 -0.048932,-0.0684 L 8.8985677,10.576249 c -0.00212,-0.02836 0.01723,-0.0423 0.043409,-0.03121 z",
      },
      {
        id: "F-BL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 6.5083371,9.5141203 1.9774235,0.8376617 c 0.025718,0.01089 0.048287,0.04242 0.050577,0.07065 l 0.1762817,2.173482 c 0.00211,0.026 -0.016134,0.03757 -0.040879,0.02596 L 6.7658471,11.728165 c -0.02281,-0.0107 -0.043546,-0.03971 -0.046516,-0.06508 L 6.471512,9.5456408 c -0.00321,-0.027455 0.0132,-0.041529 0.036825,-0.03152 z",
      },
      {
        id: "F-CR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 11.571177,8.6548036 2.596266,0.9476723 c 0.03402,0.012419 0.06082,0.049717 0.06005,0.083576 l -0.059,2.5876665 c -7e-4,0.03073 -0.02732,0.04461 -0.05965,0.03118 l -2.472812,-1.027801 c -0.02939,-0.01222 -0.05364,-0.04605 -0.05441,-0.0759 l -0.06446,-2.5075552 c -8.42e-4,-0.032732 0.02324,-0.050075 0.05402,-0.038838 z",
      },
      {
        id: "F-CC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 8.7256985,7.6161652 11.03525,8.4591829 c 0.03018,0.011016 0.05537,0.046126 0.05645,0.078677 l 0.08274,2.4945216 c 9.85e-4,0.0297 -0.02146,0.04394 -0.0503,0.03195 L 8.9124408,10.145059 c -0.026355,-0.01095 -0.049285,-0.04298 -0.05144,-0.07184 L 8.6803958,7.6549421 c -0.00235,-0.031488 0.01784,-0.048801 0.045303,-0.038777 z",
      },
      {
        id: "F-CL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 6.1794946,6.6867662 8.247338,7.4415571 c 0.026953,0.00984 0.050721,0.043003 0.053261,0.07432 l 0.1951327,2.4059066 c 0.00233,0.028721 -0.016658,0.04315 -0.042546,0.03239 L 6.4633244,9.127106 c -0.023767,-0.00988 -0.04551,-0.040274 -0.048777,-0.068185 L 6.1414248,6.72528 c -0.00355,-0.030318 0.013419,-0.047512 0.03807,-0.038514 z",
      },
      {
        id: "F-TR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 11.487035,5.252595 2.75685,0.8246779 c 0.03624,0.010841 0.06475,0.050452 0.06387,0.088756 l -0.06655,2.918608 c -7.88e-4,0.034556 -0.02909,0.052494 -0.06341,0.040272 l -2.618051,-0.932231 c -0.03103,-0.011049 -0.05667,-0.046772 -0.05753,-0.080145 L 11.42995,5.3014563 c -9.45e-4,-0.036794 0.0245,-0.05861 0.05709,-0.048861 z",
      },
      {
        id: "F-TC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 8.4848478,4.3545278 2.4352082,0.7284626 c 0.03191,0.00955 0.05861,0.046698 0.05982,0.083251 l 0.09266,2.793794 c 0.0011,0.033181 -0.02253,0.051137 -0.05294,0.040306 L 8.6928889,7.1718518 c -0.027657,-0.00985 -0.051825,-0.043559 -0.05422,-0.075628 L 8.4374892,4.4024387 c -0.00263,-0.03516 0.018481,-0.056549 0.047359,-0.047911 z",
      },
      {
        id: "F-TL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 5.8153613,3.5559837 2.1667485,0.6481562 c 0.028312,0.00847 0.053413,0.04345 0.056246,0.078388 L 8.255534,6.9602437 c 0.00259,0.03189 -0.017205,0.049749 -0.044344,0.040086 L 6.129763,6.2591783 c -0.024805,-0.00883 -0.047658,-0.040747 -0.051269,-0.071594 L 5.7759842,3.6028494 c -0.00394,-0.033653 0.01361,-0.054574 0.039377,-0.046866 z",
      },
    ],
  },
  {
    id: "up",
    transform: "matrix(3.870286,0,0,3.870286,-7.0779203,-33.779492)",
    children: [
      {
        id: "U-BR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 9.8804552,11.777624 2.6448728,0.684331 c 0.03463,0.009 0.04699,0.02675 0.02763,0.03991 l -1.676324,1.139192 c -0.02256,0.01533 -0.07002,0.01924 -0.106317,0.0087 L 8.0088381,12.851373 c -0.032643,-0.0094 -0.039509,-0.02811 -0.015473,-0.04185 l 1.7929714,-1.025116 c 0.020784,-0.01188 0.062731,-0.0149 0.094119,-0.0068 z",
      },
      {
        id: "U-BC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 6.9766452,11.026295 2.3573014,0.609926 c 0.030781,0.008 0.03872,0.02378 0.017734,0.03547 L 7.542417,12.679469 c -0.024239,0.0135 -0.069547,0.01694 -0.1015111,0.0077 L 5.0015935,11.981894 c -0.028926,-0.0084 -0.031829,-0.02491 -0.00658,-0.03709 l 1.8913086,-0.912443 c 0.022014,-0.01062 0.06227,-0.01332 0.090322,-0.0061 z",
      },
      {
        id: "U-BL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 4.3737487,10.352825 2.1142093,0.547028 c 0.027539,0.0071 0.03192,0.02127 0.00976,0.03173 L 4.5950796,11.82946 c -0.025387,0.01198 -0.068713,0.01503 -0.097073,0.0068 L 2.3275955,11.208765 c -0.025811,-0.0075 -0.025561,-0.02223 4.955e-4,-0.0331 l 1.9588711,-0.817387 c 0.022884,-0.0095 0.061566,-0.01198 0.086787,-0.0055 z",
      },
      {
        id: "U-CR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 11.748328,10.706022 2.514964,0.579629 c 0.0328,0.0076 0.04611,0.02257 0.02979,0.03367 l -1.404858,0.95471 c -0.01879,0.01277 -0.06163,0.01602 -0.09599,0.0073 l -2.62586,-0.667714 c -0.03118,-0.0079 -0.03997,-0.02362 -0.01977,-0.03517 l 1.51578,-0.866635 c 0.01767,-0.0101 0.05598,-0.01267 0.08594,-0.0058 z",
      },
      {
        id: "U-CC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 8.9646036,10.064452 2.2616264,0.521241 c 0.02943,0.0068 0.03878,0.02025 0.02091,0.0302 l -1.5316521,0.853148 c -0.020402,0.01136 -0.0615,0.01426 -0.092086,0.0065 L 7.279847,10.879596 C 7.2519439,10.8725 7.2467801,10.858459 7.26821,10.84812 l 1.6136051,-0.778468 c 0.01888,-0.0091 0.055781,-0.01142 0.082788,-0.0052 z",
      },
      {
        id: "U-CL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 6.449056,9.4846888 2.04473,0.4712528 c 0.02655,0.00612 0.032649,0.018268 0.013623,0.027246 L 6.8821456,10.750168 c -0.021575,0.01018 -0.061048,0.01277 -0.088447,0.0058 L 4.689245,10.220847 c -0.025116,-0.0064 -0.027334,-0.01903 -0.00503,-0.02834 L 6.3692268,9.4894011 c 0.019778,-0.00825 0.05536,-0.010352 0.079829,-0.00471 z",
      },
      {
        id: "U-TR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 13.346389,9.7892118 2.393208,0.4972342 c 0.03111,0.0065 0.04496,0.0193 0.031,0.02878 l -1.194386,0.811678 c -0.01588,0.01079 -0.05492,0.01354 -0.08747,0.0062 l -2.497052,-0.566656 c -0.02976,-0.0068 -0.03982,-0.02012 -0.02261,-0.02997 l 1.298248,-0.7422631 c 0.01521,-0.0087 0.05045,-0.01091 0.07906,-0.00497 z",
      },
      {
        id: "U-TC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 10.678936,9.2349981 2.168649,0.4505778 c 0.02813,0.00585 0.03843,0.017451 0.02303,0.026027 l -1.313374,0.7315643 c -0.01741,0.0097 -0.055,0.01217 -0.08424,0.0055 L 9.2248604,9.9385306 c -0.026859,-0.0061 -0.033616,-0.018159 -0.015201,-0.027044 L 10.602534,9.2395082 c 0.01637,-0.0079 0.05043,-0.00991 0.0764,-0.00451 z",
      },
      {
        id: "U-TL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 8.2515696,8.7306669 1.9742784,0.4101936 c 0.02557,0.00531 0.03289,0.015857 0.01638,0.02365 L 8.8378072,9.8272695 c -0.018561,0.00876 -0.054803,0.010991 -0.081211,0.005 L 6.72193,9.370541 c -0.024359,-0.00553 -0.028383,-0.01647 -0.00907,-0.02453 L 8.1776787,8.7347809 c 0.017263,-0.0072 0.0502,-0.00904 0.073891,-0.00411 z",
      },
    ],
  },
  {
    id: "side",
    transform: "matrix(3.870286,0,0,3.870286,22.142316,-2.7727485)",
    children: [
      {
        id: "S-BR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 6.7523859,9.4010867 1.1018816,-1.091461 c 0.012953,-0.012831 0.021075,-0.00197 0.018229,0.024306 L 7.6524172,10.365739 c -0.00264,0.02441 -0.014921,0.05513 -0.027545,0.06891 l -1.0714308,1.169959 c -0.014131,0.01543 -0.023693,0.0075 -0.02142,-0.01778 L 6.721641,9.4765428 c 0.00246,-0.027356 0.01618,-0.061029 0.030745,-0.075456 z",
      },
      {
        id: "S-BC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 5.2173576,10.921598 1.275747,-1.2636821 c 0.014931,-0.01479 0.025015,-0.00449 0.022634,0.023054 L 6.3320941,11.804734 c -0.0022,0.02545 -0.015605,0.05862 -0.030076,0.07442 l -1.2332597,1.34667 c -0.016332,0.01783 -0.028141,0.011 -0.026454,-0.01537 L 5.183449,11.003717 c 0.00184,-0.02869 0.01697,-0.06534 0.033909,-0.08212 z",
      },
      {
        id: "S-BL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 13.493751,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 3.4212484,12.700721 1.4942793,-1.480148 c 0.017398,-0.01723 0.029992,-0.0078 0.028264,0.02108 l -0.1327973,2.220894 c -0.00159,0.02653 -0.016332,0.06258 -0.033088,0.08087 l -1.4347403,1.566678 c -0.01909,0.02085 -0.033781,0.01555 -0.032909,-0.01193 l 0.073241,-2.307401 c 9.556e-4,-0.03011 0.017806,-0.0703 0.03775,-0.09005 z",
      },
      {
        id: "S-CR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 7.0062445,6.589332 8.1455037,5.6117317 c 0.013354,-0.011459 0.021575,0.00256 0.018452,0.031387 L 7.9229307,7.8683088 c -0.00289,0.026687 -0.015676,0.058327 -0.028686,0.070981 L 6.7871475,9.0160643 c -0.01464,0.014239 -0.024431,0.00335 -0.021933,-0.024457 L 6.9740683,6.6672551 c 0.00271,-0.030189 0.017074,-0.064964 0.032176,-0.077923 z",
      },
      {
        id: "S-CC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 5.4083175,7.9605159 6.7372269,6.8201765 c 0.015501,-0.013302 0.025843,5.233e-4 0.023212,0.03095 L 6.5579597,9.1927006 c -0.00242,0.028001 -0.016436,0.06226 -0.031446,0.076859 L 5.243417,10.517513 c -0.017044,0.01658 -0.029283,0.0065 -0.027415,-0.02275 L 5.3726538,8.0455927 c 0.00204,-0.031917 0.01796,-0.069885 0.035664,-0.085077 z",
      },
      {
        id: "S-CL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 9.7895832,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 3.522422,9.5788062 5.0926255,8.2314118 c 0.01821,-0.015626 0.031298,-0.00226 0.029374,0.029919 L 4.9744372,10.729147 c -0.00176,0.02941 -0.017248,0.06675 -0.034758,0.08378 l -1.5046795,1.463468 c -0.020093,0.01954 -0.035511,0.01062 -0.034537,-0.02007 l 0.082016,-2.5838621 c 0.00107,-0.033804 0.018904,-0.075606 0.039943,-0.09366 z",
      },
      {
        id: "S-TR",
        width: 3.1750002,
        height: 3.1750002,
        x: 11.1125,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "m 7.2870914,3.4786529 1.1786949,-0.833889 c 0.013773,-0.00974 0.022073,0.00802 0.018631,0.039794 L 8.2193061,5.1321165 c -0.00317,0.029299 -0.01651,0.0619 -0.029923,0.073137 L 7.0446171,6.1643145 c -0.015182,0.012719 -0.025202,-0.00173 -0.022442,-0.032442 L 7.2533453,3.559155 c 0.00301,-0.033487 0.018071,-0.069413 0.033746,-0.080502 z",
      },
      {
        id: "S-TC",
        width: 3.1750002,
        height: 3.1750002,
        x: 7.4083333,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 5.621354,4.6571089 7.0076832,3.6763253 c 0.016111,-0.011398 0.026707,0.00667 0.023785,0.040459 L 6.8071018,6.3114851 c -0.00268,0.03096 -0.01736,0.066358 -0.032946,0.079416 L 5.4373146,7.5108789 c -0.017818,0.014928 -0.030512,8.125e-4 -0.028432,-0.031704 l 0.1748617,-2.733876 c 0.00228,-0.035716 0.019073,-0.075075 0.03761,-0.08819 z",
      },
      {
        id: "S-TL",
        width: 3.1750002,
        height: 3.1750002,
        x: 3.7041667,
        y: 6.0854168,
        rx: 0.068362735,
        ry: 0.068362735,
        d: "M 3.6364128,6.0613915 5.2905243,4.8911603 c 0.019099,-0.013512 0.032712,0.00469 0.030556,0.040744 L 5.1561472,7.6902404 c -0.00196,0.032789 -0.018273,0.071503 -0.036605,0.086862 L 3.5378678,9.1021958 c -0.021205,0.017765 -0.037425,0.00435 -0.03633,-0.030148 L 3.594007,6.1588781 c 0.00121,-0.038226 0.020145,-0.081738 0.042406,-0.097487 z",
      },
    ],
  },
];
